============================
Sales Commission Custom
============================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: LGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fserver--tools-lightgray.png?logo=github
    :target: https://github.com/OCA/server-tools/tree/18.0/sales_commission_custom
    :alt: OCA/server-tools

|badge1| |badge2| |badge3|

This module provides a custom way to calculate sales commissions based on markup percentages,
completely independent from Odoo Enterprise's sale_commission module.

**Table of contents**

.. contents::
   :local:

Features
========

Commission Calculation
----------------------

* **Markup-based formula**: ((purchase_price / sale_price) - 1) × -100
* **Flexible commission calculation**: price_subtotal × commission_factor
* **Configurable factor table**: Define markup percentage → commission factor mappings
* **Edge case handling**: Automatic fallback for markups outside configured ranges
* **Real-time updates**: Computed fields update automatically when prices change

Vendor Management
-----------------

* **Independent vendor field**: product_vendor_id per sale order line
* **Flexible selection**: Choose any partner, not restricted to suppliers
* **Manual assignment**: User-controlled vendor selection
* **State control**: Vendor assignment only in 'draft' and 'sent' states

Cost & Markup Analysis
----------------------

* **Total cost tracking**: Automatic sum of all line costs
* **Markup calculations**: Based on amount_untaxed (excluding taxes)
* **Rounded percentages**: Integer markup percentages for better UX
* **Order-level summaries**: Complete cost and profitability overview

Configuration
=============

Commission Factors
------------------

Navigate to **Sales > Sales Commission > Commission Factors** to configure:

1. **Markup Percentage**: Integer value (e.g., 15 for 15%)
2. **Commission Factor**: Decimal factor (e.g., 0.004)

Example configuration::

    Markup 10% → Factor 0.002
    Markup 15% → Factor 0.004
    Markup 20% → Factor 0.010
    Markup 25% → Factor 0.012

Usage
=====

Basic Workflow
--------------

1. **Create Sale Order**: Standard Odoo sale order creation
2. **Add Products**: Add products to order lines
3. **Set Purchase Price**: Use sale_margin module's purchase_price field
4. **Assign Vendor** (optional): Select vendor for each line
5. **View Calculations**: Markup and commission calculated automatically

Commission Calculation Example
------------------------------

For a sale order line with:

* Sale Price: $100
* Purchase Price: $80
* Quantity: 2
* Configured Factor for 20% markup: 0.010

Results:

* Markup Percentage: 20% (rounded)
* Markup Amount: $20 per unit
* Price Subtotal: $200
* Commission Amount: $200 × 0.010 = $2.00

Order Level Summary
-------------------

The module provides order-level summaries:

* **Total Cost Amount**: Sum of all line costs
* **Total Markup Amount**: Total sales amount - total cost amount
* **Total Markup Percentage**: Overall markup percentage (rounded)
* **Total Commission Amount**: Sum of all line commissions

Technical Details
=================

Models
------

**sales.commission.factor**
  Configuration model for markup → factor mappings

**sale.order** (extended)
  Added fields for cost and markup summaries

**sale.order.line** (extended)
  Added fields for vendor, markup calculation, and commission

Fields Added
------------

Sale Order Line:
  * ``product_vendor_id``: Vendor for commission purposes
  * ``markup_percentage``: Calculated markup percentage (rounded)
  * ``markup_amount``: Markup amount per unit
  * ``commission_factor``: Applied commission factor
  * ``commission_amount``: Total commission for the line

Sale Order:
  * ``total_cost_amount``: Total cost for all lines
  * ``total_markup_amount``: Total markup amount
  * ``total_markup_percentage``: Total markup percentage (rounded)
  * ``total_commission_amount``: Total commission amount

Dependencies
============

* ``sale``: Core sales functionality
* ``sale_margin``: Provides purchase_price field

Security
========

* **Commission Factors**: Only system administrators can modify
* **Vendor Assignment**: Users with sale order edit permissions
* **View Access**: Sales users can view commission calculations

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/server-tools/issues>`_.
In case of trouble, please check there if your issue has already been reported.

Credits
=======

Authors
-------

* Custom Development Team

Contributors
------------

* Custom Development Team

Maintainers
-----------

This module is maintained by Custom Development Team.
